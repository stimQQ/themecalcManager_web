<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¼–è¾‘ä¸»é¢˜ - è®¡ç®—å™¨çš®è‚¤ä¸»é¢˜ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div id="loading-indicator">
        <div class="loader"></div>
    </div>
    
    <!-- ä¾§è¾¹æ åˆ‡æ¢æŒ‰é’®ï¼ˆç§»åŠ¨ç«¯æ˜¾ç¤ºï¼‰ -->
    <button id="toggle-sidebar" class="toggle-sidebar">â˜°</button>
    
    <!-- é¡µé¢å®¹å™¨ -->
    <div class="page-container">
        <!-- å·¦ä¾§å¯¼èˆªæ  -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand">ä¸»é¢˜ç®¡ç†ç³»ç»Ÿ</div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <i>ğŸ“‹</i> ä¸»é¢˜ç®¡ç†
                    </a>
                </li>
                <li class="nav-item">
                    <a href="create.html" class="nav-link">
                        <i>â•</i> ä¸»é¢˜åˆ›å»º
                    </a>
                    <ul class="submenu" id="theme-edit-submenu">
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" data-step="basic-info-step">åŸºæœ¬ä¿¡æ¯</a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" data-step="global-settings-step">å…¨å±€è®¾ç½®</a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" data-step="top-nav-step">é¡¶éƒ¨å¯¼èˆª</a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" data-step="result-area-step">è®¡ç®—ç»“æœåŒº</a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" data-step="button-skins-step">æŒ‰é’®çš®è‚¤</a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" data-step="tabbar-settings-step">Tabbarè‡ªå®šä¹‰</a>
                        </li>
                        <li class="submenu-item">
                            <a href="#" class="submenu-link" data-step="summary-step">ç¡®è®¤æäº¤</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
        
        <!-- ä¸»è¦å†…å®¹ -->
        <div class="main-content-wrapper">
            <!-- å¤´éƒ¨ -->
            <header>
                <div class="container header-container">
                    <div class="logo">è®¡ç®—å™¨çš®è‚¤ä¸»é¢˜ç®¡ç†ç³»ç»Ÿ</div>
                    <div class="user-info">
                        <button id="logout-button" class="btn">é€€å‡ºç™»å½•</button>
                    </div>
                </div>
            </header>
            
            <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
            <div class="container">
                <!-- æ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸ -->
                <div id="message" class="message"></div>
                
                <!-- è¿”å›é“¾æ¥ -->
                <div class="back-links">
                    <a href="index.html" class="back-link">â† è¿”å›ä¸»é¢˜åˆ—è¡¨</a>
                    <a href="#" id="view-detail-link" class="back-link">æŸ¥çœ‹ä¸»é¢˜è¯¦æƒ… â†’</a>
                </div>
                
                <!-- ä¸»é¢˜ç¼–è¾‘é¡µé¢ -->
                <div id="theme-edit-page" class="page-content">
                    <div class="main-content">
                        <h2>ç¼–è¾‘ä¸»é¢˜ <span id="theme-name-display"></span></h2>
                        
                        <!-- æ­¥éª¤å¯¼èˆª -->
                        <div class="steps-nav">
                            <div class="step-link active" data-step="basic-info-step">1. åŸºæœ¬ä¿¡æ¯</div>
                            <div class="step-link" data-step="global-settings-step">2. å…¨å±€è®¾ç½®</div>
                            <div class="step-link" data-step="top-nav-step">3. é¡¶éƒ¨å¯¼èˆª</div>
                            <div class="step-link" data-step="result-area-step">4. è®¡ç®—ç»“æœåŒº</div>
                            <div class="step-link" data-step="button-skins-step">5. æŒ‰é’®çš®è‚¤</div>
                            <div class="step-link" data-step="tabbar-settings-step">6. Tabbarè‡ªå®šä¹‰</div>
                            <div class="step-link" data-step="summary-step">7. ç¡®è®¤æäº¤</div>
                        </div>
                        
                        <!-- åŠ è½½ä¸­ -->
                        <div id="step-loading" style="display: none;">
                            <div class="loader"></div>
                        </div>
                        
                        <form id="theme-edit-form">
                            <!-- éšè—å­—æ®µï¼šä¸»é¢˜ID -->
                            <input type="hidden" id="theme-id" name="theme_id">
                            <!-- éšè—å­—æ®µï¼šç”¨äºèƒŒæ™¯ç±»å‹é€‰æ‹© -->
                            <input type="hidden" id="has_global_background_image" name="has_global_background_image" value="false">
                            <input type="hidden" id="result_use_image" name="result_use_image" value="false">
                            <input type="hidden" id="tabbar_use_background_image" name="tabbar_use_background_image" value="false">
                            
                            <!-- æ­¥éª¤1: åŸºæœ¬ä¿¡æ¯ -->
                            <div id="basic-info-step" class="step-content active">
                                <div class="form-group">
                                    <label for="skin_name">ä¸»é¢˜åç§° *</label>
                                    <input type="text" id="skin_name" name="skin_name" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="version">ç‰ˆæœ¬å·</label>
                                    <input type="text" id="version" name="version">
                                </div>
                                
                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="is_paid" name="is_paid">
                                    <label for="is_paid">ä»˜è´¹ä¸»é¢˜</label>
                                </div>
                                
                                <div class="form-group-row">
                                    <div class="form-group form-group-half">
                                        <label for="detail_image">é¢„è§ˆå›¾ç‰‡</label>
                                        <input type="file" id="detail_image" name="detail_image" accept="image/*">
                                        <div class="current-image-container">
                                            <p>å½“å‰å›¾ç‰‡:</p>
                                            <img id="current-detail-image" class="current-image">
                                        </div>
                                        <img id="detail-image-preview" class="image-preview">
                                    </div>
                                    
                                    <div class="form-group form-group-half">
                                        <label for="preview_image">è¯¦æƒ…å›¾ç‰‡</label>
                                        <input type="file" id="preview_image" name="preview_image" accept="image/*">
                                        <div class="current-image-container">
                                            <p>å½“å‰å›¾ç‰‡:</p>
                                            <img id="current-preview-image" class="current-image">
                                        </div>
                                        <img id="preview-image-preview" class="image-preview">
                                    </div>
                                </div>
                                
                                <div class="step-buttons">
                                    <button type="button" class="btn cancel-btn" id="cancel-edit-button">å–æ¶ˆ</button>
                                    <button type="button" class="btn next-step" data-next="global-settings-step">ä¿å­˜å¹¶ç»§ç»­</button>
                                </div>
                            </div>
                            
                            <!-- æ­¥éª¤2: å…¨å±€è®¾ç½® -->
                            <div id="global-settings-step" class="step-content">
                                <div class="form-group">
                                    <label>å…¨å±€èƒŒæ™¯è®¾ç½®</label>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="global_bg_color_option" name="global_bg_type" value="color">
                                            <label for="global_bg_color_option">ä½¿ç”¨èƒŒæ™¯é¢œè‰²</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="global_bg_image_option" name="global_bg_type" value="image">
                                            <label for="global_bg_image_option">ä½¿ç”¨èƒŒæ™¯å›¾ç‰‡</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group" id="global_bg_color_group">
                                    <label for="global_background_color">å…¨å±€èƒŒæ™¯é¢œè‰²</label>
                                    <div class="color-input-group">
                                        <input type="color" id="global_background_color" name="global_background_color">
                                        <input type="text" id="global_background_color_text" placeholder="#FFFFFF" maxlength="7">
                                    </div>
                                </div>
                                
                                <div class="form-group" id="global_bg_image_group">
                                    <label for="global_background_image">å…¨å±€èƒŒæ™¯å›¾ç‰‡</label>
                                    <input type="file" id="global_background_image" name="global_background_image" accept="image/*">
                                    <div class="current-image-container">
                                        <p>å½“å‰å›¾ç‰‡:</p>
                                        <img id="current-global-bg-image" class="current-image">
                                    </div>
                                    <img id="global-background-preview" class="image-preview">
                                </div>
                                
                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="use_system_font" name="use_system_font">
                                    <label for="use_system_font">ä½¿ç”¨ç³»ç»Ÿå­—ä½“</label>
                                </div>
                                
                                <div class="step-buttons">
                                    <button type="button" class="btn prev-step" data-prev="basic-info-step">ä¸Šä¸€æ­¥</button>
                                    <button type="button" class="btn next-step" data-next="top-nav-step">ä¿å­˜å¹¶ç»§ç»­</button>
                                </div>
                            </div>
                            
                            <!-- æ­¥éª¤3: é¡¶éƒ¨å¯¼èˆªåŒº -->
                            <div id="top-nav-step" class="step-content">
                                <!-- é¡¶éƒ¨å¯¼èˆªåŒºè¡¨å•å†…å®¹... -->
                                <div class="form-group">
                                    <label for="top_nav_selected_color">å¯¼èˆªé€‰ä¸­é¢œè‰²</label>
                                    <div class="color-input-group">
                                        <input type="color" id="top_nav_selected_color" name="top_nav_selected_color" value="#4a6cf7">
                                        <input type="text" id="top_nav_selected_color_text" placeholder="#4A6CF7" maxlength="7">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="top_nav_unselected_color">å¯¼èˆªæœªé€‰ä¸­é¢œè‰²</label>
                                    <div class="color-input-group">
                                        <input type="color" id="top_nav_unselected_color" name="top_nav_unselected_color" value="#6c757d">
                                        <input type="text" id="top_nav_unselected_color_text" placeholder="#6C757D" maxlength="7">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="top_nav_text_selected_color">æ–‡å­—é€‰ä¸­é¢œè‰²</label>
                                    <div class="color-input-group">
                                        <input type="color" id="top_nav_text_selected_color" name="top_nav_text_selected_color" value="#FFFFFF">
                                        <input type="text" id="top_nav_text_selected_color_text" placeholder="#FFFFFF" maxlength="7">
                                    </div>
                                    <span class="form-tip">å»ºè®®ä¸å¯¼èˆªé€‰ä¸­é¢œè‰²ä¸€è‡´</span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="top_nav_text_unselected_color">æ–‡å­—æœªé€‰ä¸­é¢œè‰²</label>
                                    <div class="color-input-group">
                                        <input type="color" id="top_nav_text_unselected_color" name="top_nav_text_unselected_color" value="#CCCCCC">
                                        <input type="text" id="top_nav_text_unselected_color_text" placeholder="#CCCCCC" maxlength="7">
                                    </div>
                                </div>
                                
                                <div class="step-buttons">
                                    <button type="button" class="btn prev-step" data-prev="global-settings-step">ä¸Šä¸€æ­¥</button>
                                    <button type="button" class="btn next-step" data-next="result-area-step">ä¿å­˜å¹¶ç»§ç»­</button>
                                </div>
                            </div>
                            
                            <!-- æ­¥éª¤4: è®¡ç®—ç»“æœåŒº -->
                            <div id="result-area-step" class="step-content">
                                <div class="form-group">
                                    <label>ç»“æœåŒºåŸŸèƒŒæ™¯è®¾ç½®</label>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="result_bg_color_option" name="result_bg_type" value="color" checked>
                                            <label for="result_bg_color_option">ä½¿ç”¨èƒŒæ™¯é¢œè‰²</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="result_bg_image_option" name="result_bg_type" value="image">
                                            <label for="result_bg_image_option">ä½¿ç”¨èƒŒæ™¯å›¾ç‰‡</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group" id="result_bg_color_group">
                                    <label for="result_background_color">ç»“æœåŒºåŸŸèƒŒæ™¯é¢œè‰² *</label>
                                    <div class="color-input-group">
                                        <input type="color" id="result_background_color" name="result_background_color" value="#F5F5F5" required>
                                        <input type="text" id="result_background_color_text" placeholder="#F5F5F5" maxlength="7">
                                    </div>
                                </div>
                                
                                <div class="form-group" id="result_bg_image_group" style="display: none;">
                                    <label for="result_background_image">ç»“æœåŒºåŸŸèƒŒæ™¯å›¾ç‰‡</label>
                                    <input type="file" id="result_background_image" name="result_background_image" accept="image/*">
                                    <div class="current-image-container">
                                        <p>å½“å‰å›¾ç‰‡:</p>
                                        <img id="current-result-bg-image" class="current-image">
                                    </div>
                                    <img id="result-background-preview" class="image-preview">
                                </div>
                                
                                <div class="form-group">
                                    <label for="result_font_color">ç»“æœå­—ä½“é¢œè‰²</label>
                                    <div class="color-input-group">
                                        <input type="color" id="result_font_color" name="result_font_color" value="#000000">
                                        <input type="text" id="result_font_color_text" placeholder="#000000" maxlength="7">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="result_font_size">ç»“æœå­—ä½“å¤§å°</label>
                                    <input type="number" id="result_font_size" name="result_font_size" value="24" min="12" max="40" required>
                                    <span class="form-tip">å­—ä½“å¤§å°èŒƒå›´ä¸ºï¼š12pt-40pt</span>
                                </div>
                                
                                <div class="step-buttons">
                                    <button type="button" class="btn prev-step" data-prev="top-nav-step">ä¸Šä¸€æ­¥</button>
                                    <button type="button" class="btn next-step" data-next="button-skins-step">ä¿å­˜å¹¶ç»§ç»­</button>
                                </div>
                            </div>
                            
                            <!-- æ­¥éª¤5: æŒ‰é’®çš®è‚¤ -->
                            <div id="button-skins-step" class="step-content">
                                <!-- æŒ‰é’®ç±»å‹å¯¼èˆª -->
                                <div class="button-types-nav">
                                    <div class="button-type-link active" data-button-type="button-type-a">Aç±» - åŠŸèƒ½æŒ‰é’®</div>
                                    <div class="button-type-link" data-button-type="button-type-b">Bç±» - è¿ç®—ç¬¦æŒ‰é’®</div>
                                    <div class="button-type-link" data-button-type="button-type-c">Cç±» - æ•°å­—æŒ‰é’®</div>
                                    <div class="button-type-link" data-button-type="button-type-d">Dç±» - ç­‰å·æŒ‰é’®</div>
                                    <div class="button-type-link" data-button-type="button-type-e">Eç±» - ç§‘å­¦åŠŸèƒ½æŒ‰é’®</div>
                                    <div class="button-type-link" data-button-type="button-type-f">Fç±» - ç§‘å­¦è®¡ç®—å™¨åŠŸèƒ½æŒ‰é’®</div>
                                    <div class="button-type-link" data-button-type="button-type-g">Gç±» - ç§‘å­¦è®¡ç®—å™¨è¿ç®—ç¬¦æŒ‰é’®</div>
                                    <div class="button-type-link" data-button-type="button-type-h">Hç±» - ç§‘å­¦è®¡ç®—å™¨æ•°å­—æŒ‰é’®</div>
                                    <div class="button-type-link" data-button-type="button-type-i">Iç±» - ç§‘å­¦è®¡ç®—å™¨ç­‰å·æŒ‰é’®</div>
                                </div>
                                
                                <!-- Aç±»æŒ‰é’®è®¾ç½®ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰ -->
                                <div id="button-type-a-settings" class="button-type-settings">
                                    <h3>Aç±»åŠŸèƒ½æŒ‰é’®(AC, Â±, %)</h3>
                                    
                                    <div class="form-group checkbox-group">
                                        <input type="checkbox" id="button_TYPE_A_use_image" name="button_TYPE_A_use_image">
                                        <label for="button_TYPE_A_use_image">ä½¿ç”¨æŒ‰é’®å›¾ç‰‡</label>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="button_TYPE_A_pressed_image">æŒ‰ä¸‹çŠ¶æ€å›¾ç‰‡</label>
                                        <input type="file" id="button_TYPE_A_pressed_image" name="button_TYPE_A_pressed_image" accept="image/*">
                                        <div class="current-image-container">
                                            <p>å½“å‰å›¾ç‰‡:</p>
                                            <img id="current-button-a-pressed-image" class="current-image">
                                        </div>
                                        <img id="button-a-pressed-preview" class="image-preview">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="button_TYPE_A_released_image">é‡Šæ”¾çŠ¶æ€å›¾ç‰‡</label>
                                        <input type="file" id="button_TYPE_A_released_image" name="button_TYPE_A_released_image" accept="image/*">
                                        <div class="current-image-container">
                                            <p>å½“å‰å›¾ç‰‡:</p>
                                            <img id="current-button-a-released-image" class="current-image">
                                        </div>
                                        <img id="button-a-released-preview" class="image-preview">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="button_TYPE_A_pressed_color">æŒ‰ä¸‹çŠ¶æ€é¢œè‰²</label>
                                        <div class="color-input-group">
                                            <input type="color" id="button_TYPE_A_pressed_color" name="button_TYPE_A_pressed_color" value="#D0D0D0">
                                            <input type="text" id="button_TYPE_A_pressed_color_text" placeholder="#D0D0D0" maxlength="7">
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="button_TYPE_A_released_color">é‡Šæ”¾çŠ¶æ€é¢œè‰²</label>
                                        <div class="color-input-group">
                                            <input type="color" id="button_TYPE_A_released_color" name="button_TYPE_A_released_color" value="#E0E0E0">
                                            <input type="text" id="button_TYPE_A_released_color_text" placeholder="#E0E0E0" maxlength="7">
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="button_TYPE_A_font_color">å­—ä½“é¢œè‰²</label>
                                        <div class="color-input-group">
                                            <input type="color" id="button_TYPE_A_font_color" name="button_TYPE_A_font_color" value="#000000">
                                            <input type="text" id="button_TYPE_A_font_color_text" placeholder="#000000" maxlength="7">
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="button_TYPE_A_font_size">å­—ä½“å¤§å°</label>
                                        <input type="number" id="button_TYPE_A_font_size" name="button_TYPE_A_font_size" value="18" min="12" max="36" required>
                                    </div>
                                </div>
                                
                                <div class="step-buttons">
                                    <button type="button" class="btn prev-step" data-prev="result-area-step">ä¸Šä¸€æ­¥</button>
                                    <button type="button" class="btn next-step" data-next="tabbar-settings-step">ä¿å­˜å¹¶ç»§ç»­</button>
                                </div>
                            </div>
                            
                            <!-- æ­¥éª¤6: TabBarè®¾ç½® -->
                            <div id="tabbar-settings-step" class="step-content">
                                <!-- TabBarèƒŒæ™¯è®¾ç½® -->
                                <div class="form-group">
                                    <label>TabBarèƒŒæ™¯è®¾ç½®</label>
                                    <div class="radio-group">
                                        <div class="radio-item">
                                            <input type="radio" id="tabbar_bg_color_option" name="tabbar_bg_type" value="color" checked>
                                            <label for="tabbar_bg_color_option">ä½¿ç”¨èƒŒæ™¯é¢œè‰²</label>
                                        </div>
                                        <div class="radio-item">
                                            <input type="radio" id="tabbar_bg_image_option" name="tabbar_bg_type" value="image">
                                            <label for="tabbar_bg_image_option">ä½¿ç”¨èƒŒæ™¯å›¾ç‰‡</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group" id="tabbar_bg_color_group">
                                    <label for="tabbar_background_color">TabBarèƒŒæ™¯é¢œè‰²</label>
                                    <div class="color-input-group">
                                        <input type="color" id="tabbar_background_color" name="tabbar_background_color" value="#FFFFFF">
                                        <input type="text" id="tabbar_background_color_text" placeholder="#FFFFFF" maxlength="7">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="tabbar_opacity">èƒŒæ™¯é€æ˜åº¦</label>
                                    <input type="range" id="tabbar_opacity" name="tabbar_opacity" min="0" max="1" step="0.1" value="1">
                                    <span id="tabbar_opacity_value">1</span>
                                </div>
                                
                                <div class="form-group" id="tabbar_bg_image_group" style="display: none;">
                                    <label for="tabbar_background_image">TabBarèƒŒæ™¯å›¾ç‰‡</label>
                                    <input type="file" id="tabbar_background_image" name="tabbar_background_image" accept="image/*">
                                    <div class="current-image-container">
                                        <p>å½“å‰å›¾ç‰‡:</p>
                                        <img id="current-tabbar-bg-image" class="current-image">
                                    </div>
                                    <img id="tabbar-background-preview" class="image-preview">
                                </div>
                                
                                <div class="form-group">
                                    <label for="tabbar_font_size">å­—ä½“å¤§å°</label>
                                    <input type="number" id="tabbar_font_size" name="tabbar_font_size" value="12" min="10" max="18">
                                </div>
                                
                                <div class="step-buttons">
                                    <button type="button" class="btn prev-step" data-prev="button-skins-step">ä¸Šä¸€æ­¥</button>
                                    <button type="button" class="btn next-step" data-next="summary-step">ä¿å­˜å¹¶ç»§ç»­</button>
                                </div>
                            </div>
                            
                            <!-- æ­¥éª¤7: ç¡®è®¤æäº¤ -->
                            <div id="summary-step" class="step-content">
                                <h3>è¯·ç¡®è®¤ä»¥ä¸‹ä¿¡æ¯</h3>
                                <div class="summary-container">
                                    <!-- åŸºæœ¬ä¿¡æ¯æ‘˜è¦ -->
                                    <!-- å…¶ä»–æ‘˜è¦ä¿¡æ¯... -->
                                </div>
                                
                                <div class="step-buttons">
                                    <button type="button" class="btn prev-step" data-prev="tabbar-settings-step">ä¸Šä¸€æ­¥</button>
                                    <button type="submit" class="btn submit-btn" id="edit-submit-button">ç¡®è®¤æäº¤</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- è„šæœ¬ -->
    <script src="js/api.js"></script>
    <script src="js/field-normalizer.js"></script>
    <script src="js/theme-fixes.js"></script>
    <script>
        // è·å–URLå‚æ•°
        function getUrlParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        function showErrorMessage(message) {
            const messageElement = document.getElementById('message');
            if (!messageElement) return;
            
            messageElement.textContent = message;
            messageElement.className = 'message error';
            messageElement.style.display = 'block';
            
            // 5ç§’åéšè—æ¶ˆæ¯
            setTimeout(() => {
                messageElement.style.display = 'none';
            }, 5000);
        }
        
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        function showSuccessMessage(message) {
            const messageElement = document.getElementById('message');
            if (!messageElement) return;
            
            messageElement.textContent = message;
            messageElement.className = 'message success';
            messageElement.style.display = 'block';
            
            // 5ç§’åéšè—æ¶ˆæ¯
            setTimeout(() => {
                messageElement.style.display = 'none';
            }, 5000);
        }
        
        // æ­¥éª¤åˆ‡æ¢
        document.querySelectorAll('.step-link').forEach(link => {
            link.addEventListener('click', function() {
                const targetStep = this.getAttribute('data-step');
                showStepSafely(targetStep);
            });
        });
        
        document.querySelectorAll('.next-step').forEach(button => {
            button.addEventListener('click', function() {
                const nextStep = this.getAttribute('data-next');
                showStepSafely(nextStep);
            });
        });
        
        document.querySelectorAll('.prev-step').forEach(button => {
            button.addEventListener('click', function() {
                const prevStep = this.getAttribute('data-prev');
                showStepSafely(prevStep);
            });
        });
        
        // å®‰å…¨åœ°æ‰§è¡ŒshowStepï¼Œé˜²æ­¢é”™è¯¯
        function showStepSafely(stepId) {
            if (!stepId) {
                console.error('showStepSafely: æä¾›çš„stepIdä¸ºç©º');
                return;
            }
            
            try {
                console.log(`å°è¯•æ˜¾ç¤ºæ­¥éª¤: ${stepId}`);
                
                // å…ˆç¡®è®¤ç›®æ ‡æ­¥éª¤å…ƒç´ å­˜åœ¨
                const targetStep = document.getElementById(stepId);
                if (!targetStep) {
                    console.error(`æ­¥éª¤å…ƒç´ ä¸å­˜åœ¨: #${stepId}`);
                    return;
                }
                
                // å°è¯•ä½¿ç”¨showStepå‡½æ•°åˆ‡æ¢æ­¥éª¤
                if (typeof showStep === 'function') {
                    showStep(stepId);
                } else {
                    console.error('showStepå‡½æ•°ä¸å­˜åœ¨ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ');
                    
                    // å¤‡ç”¨æ–¹æ¡ˆï¼šç›´æ¥ä¿®æ”¹DOM
                    document.querySelectorAll('.step-content').forEach(step => {
                        step.classList.remove('active');
                    });
                    
                    targetStep.classList.add('active');
                    
                    // æ›´æ–°æ­¥éª¤å¯¼èˆªçŠ¶æ€
                    document.querySelectorAll('.step-link').forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('data-step') === stepId) {
                            link.classList.add('active');
                        }
                    });
                    
                    console.log(`å·²ç›´æ¥åˆ‡æ¢åˆ°æ­¥éª¤: ${stepId}`);
                }
            } catch (error) {
                console.error(`æ˜¾ç¤ºæ­¥éª¤ ${stepId} æ—¶å‡ºé”™:`, error);
                
                // ç´§æ€¥ä¿®å¤ï¼šç›´æ¥åˆ‡æ¢DOM
                document.querySelectorAll('.step-content').forEach(step => {
                    step.classList.remove('active');
                });
                
                const targetStep = document.getElementById(stepId);
                if (targetStep) {
                    targetStep.classList.add('active');
                    console.log(`å·²ç›´æ¥åˆ‡æ¢åˆ°æ­¥éª¤: ${stepId}`);
                } else {
                    console.error(`æ‰¾ä¸åˆ°æ­¥éª¤å…ƒç´ : #${stepId}`);
                }
            }
        }
        
        // åŠ è½½ä¸»é¢˜æ•°æ®
        async function loadThemeData() {
            const themeId = getUrlParam('id');
            
            if (!themeId) {
                showErrorMessage('æœªæŒ‡å®šä¸»é¢˜ID');
                return;
            }
            
            try {
                // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
                document.getElementById('loading-indicator').style.display = 'block';
                
                // è·å–ä¸»é¢˜è¯¦æƒ…
                const theme = await themeAPI.getThemeDetail(themeId);
                
                // å¡«å……è¡¨å•
                fillThemeForm(theme);
                
                // æ›´æ–°ä¸»é¢˜åç§°æ˜¾ç¤º
                document.getElementById('theme-name-display').textContent = theme.name || '';
                
                // æ›´æ–°"æŸ¥çœ‹ä¸»é¢˜è¯¦æƒ…"é“¾æ¥
                document.getElementById('view-detail-link').href = `detail.html?id=${themeId}`;
            } catch (error) {
                console.error('åŠ è½½ä¸»é¢˜æ•°æ®å¤±è´¥:', error);
                showErrorMessage(`åŠ è½½ä¸»é¢˜æ•°æ®å¤±è´¥: ${error.message}`);
            } finally {
                // éšè—åŠ è½½æŒ‡ç¤ºå™¨
                document.getElementById('loading-indicator').style.display = 'none';
            }
        }
        
        // å¡«å……è¡¨å•
        function fillThemeForm(theme) {
            // è®¾ç½®ä¸»é¢˜ID
            document.getElementById('theme-id').value = theme.id;
            
            // åŸºæœ¬ä¿¡æ¯
            document.getElementById('skin_name').value = theme.name || '';
            document.getElementById('version').value = theme.version || '1.0';
            document.getElementById('is_paid').checked = theme.is_paid || false;
            
            // æ˜¾ç¤ºå½“å‰å›¾ç‰‡
            if (theme.detail_image) {
                const currentDetailImage = document.getElementById('current-detail-image');
                currentDetailImage.src = theme.detail_image;
                currentDetailImage.parentElement.style.display = 'block';
            }
            
            // æ˜¾ç¤ºå½“å‰é¢„è§ˆå›¾ç‰‡
            if (theme.preview_image) {
                const currentPreviewImage = document.getElementById('current-preview-image');
                currentPreviewImage.src = theme.preview_image;
                currentPreviewImage.parentElement.style.display = 'block';
            }
            
            // å…¨å±€è®¾ç½®
            document.getElementById('use_system_font').checked = theme.use_system_font || false;
            
            // è®¾ç½®èƒŒæ™¯ç±»å‹
            if (theme.has_global_background_image) {
                document.getElementById('global_bg_image_option').checked = true;
                document.getElementById('global_bg_color_group').style.display = 'none';
                document.getElementById('global_bg_image_group').style.display = 'block';
                document.getElementById('has_global_background_image').value = 'true';
                
                // æ˜¾ç¤ºå½“å‰èƒŒæ™¯å›¾ç‰‡
                if (theme.global_background_image) {
                    const currentBgImage = document.getElementById('current-global-bg-image');
                    currentBgImage.src = theme.global_background_image;
                    currentBgImage.parentElement.style.display = 'block';
                }
            } else {
                document.getElementById('global_bg_color_option').checked = true;
                document.getElementById('global_bg_color_group').style.display = 'block';
                document.getElementById('global_bg_image_group').style.display = 'none';
                document.getElementById('has_global_background_image').value = 'false';
                
                // è®¾ç½®èƒŒæ™¯é¢œè‰²
                const bgColor = theme.global_background_color || '#FFFFFF';
                document.getElementById('global_background_color').value = bgColor;
                document.getElementById('global_background_color_text').value = bgColor;
            }
            
            // é¡¶éƒ¨å¯¼èˆªåŒºè®¾ç½®
            if (document.getElementById('top_nav_selected_color')) {
                document.getElementById('top_nav_selected_color').value = theme.top_nav_selected_color || '#4a6cf7';
                document.getElementById('top_nav_unselected_color').value = theme.top_nav_unselected_color || '#6c757d';
                document.getElementById('top_nav_text_selected_color').value = theme.top_nav_text_selected_color || '#FFFFFF';
                document.getElementById('top_nav_text_unselected_color').value = theme.top_nav_text_unselected_color || '#CCCCCC';
            }
            
            // è®¡ç®—ç»“æœåŒºè®¾ç½®
            if (document.getElementById('result_background_color')) {
                // è®¾ç½®ç»“æœåŒºåŸŸèƒŒæ™¯ç±»å‹
                if (theme.result_use_image === 'true' || theme.result_use_image === true) {
                    document.getElementById('result_bg_image_option').checked = true;
                    document.getElementById('result_bg_color_group').style.display = 'none';
                    document.getElementById('result_bg_image_group').style.display = 'block';
                    document.getElementById('result_use_image').value = 'true';
                    
                    // æ˜¾ç¤ºå½“å‰ç»“æœåŒºåŸŸèƒŒæ™¯å›¾ç‰‡
                    if (theme.result_background_image) {
                        const currentResultBgImage = document.getElementById('current-result-bg-image');
                        if (currentResultBgImage) {
                            currentResultBgImage.src = theme.result_background_image;
                            currentResultBgImage.parentElement.style.display = 'block';
                        }
                    }
                } else {
                    document.getElementById('result_bg_color_option').checked = true;
                    document.getElementById('result_bg_color_group').style.display = 'block';
                    document.getElementById('result_bg_image_group').style.display = 'none';
                    document.getElementById('result_use_image').value = 'false';
                }
                
                document.getElementById('result_background_color').value = theme.result_background_color || '#F5F5F5';
                document.getElementById('result_font_color').value = theme.result_font_color || '#000000';
                document.getElementById('result_font_size').value = theme.result_font_size || '24';
            }
            
            // æŒ‰é’®çš®è‚¤è®¾ç½®
            const buttonTypes = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'];
            buttonTypes.forEach(type => {
                const useImageCheckbox = document.getElementById(`button_TYPE_${type}_use_image`);
                if (!useImageCheckbox) return;
                
                const useImage = theme[`button_TYPE_${type}_use_image`] === 'true' || theme[`button_TYPE_${type}_use_image`] === true;
                useImageCheckbox.checked = useImage;
                
                // æ›´æ–°æŒ‰é’®å›¾ç‰‡/é¢œè‰²æ§ä»¶å¯è§æ€§
                if (typeof updateButtonTypeVisibility === 'function') {
                    updateButtonTypeVisibility(type, useImage);
                } else {
                    // å¤‡ç”¨æ–¹å¼è®¾ç½®å¯è§æ€§
                    const imageFields = document.querySelectorAll(`[id^="button_TYPE_${type}_"][id$="_image"]`);
                    imageFields.forEach(el => {
                        if (el.id !== `button_TYPE_${type}_use_image`) {
                            const parent = el.closest('.form-group');
                            if (parent) parent.style.display = useImage ? 'block' : 'none';
                        }
                    });
                    
                    const colorFields = document.querySelectorAll(`[id^="button_TYPE_${type}_"][id$="_color"]`);
                    colorFields.forEach(el => {
                        const parent = el.closest('.form-group');
                        if (parent && !parent.classList.contains('checkbox-group')) {
                            parent.style.display = useImage ? 'none' : 'block';
                        }
                    });
                }
                
                // è®¾ç½®æŒ‰é’®é¢œè‰²å’Œå­—ä½“
                if (document.getElementById(`button_TYPE_${type}_pressed_color`)) {
                    document.getElementById(`button_TYPE_${type}_pressed_color`).value = theme[`button_TYPE_${type}_pressed_color`] || '#D0D0D0';
                    document.getElementById(`button_TYPE_${type}_released_color`).value = theme[`button_TYPE_${type}_released_color`] || '#E0E0E0';
                    document.getElementById(`button_TYPE_${type}_font_color`).value = theme[`button_TYPE_${type}_font_color`] || '#000000';
                    document.getElementById(`button_TYPE_${type}_font_size`).value = theme[`button_TYPE_${type}_font_size`] || '18';
                }
                
                // æ˜¾ç¤ºå½“å‰æŒ‰é’®å›¾ç‰‡
                if (useImage) {
                    if (theme[`button_TYPE_${type}_pressed_image`]) {
                        const currentPressedImage = document.getElementById(`current-button-${type.toLowerCase()}-pressed-image`);
                        if (currentPressedImage) {
                            currentPressedImage.src = theme[`button_TYPE_${type}_pressed_image`];
                            currentPressedImage.parentElement.style.display = 'block';
                        }
                    }
                    
                    if (theme[`button_TYPE_${type}_released_image`]) {
                        const currentReleasedImage = document.getElementById(`current-button-${type.toLowerCase()}-released-image`);
                        if (currentReleasedImage) {
                            currentReleasedImage.src = theme[`button_TYPE_${type}_released_image`];
                            currentReleasedImage.parentElement.style.display = 'block';
                        }
                    }
                }
            });
            
            // TabBarè®¾ç½®
            if (document.getElementById('tabbar_background_color')) {
                // è®¾ç½®TabBarèƒŒæ™¯ç±»å‹
                if (theme.tabbar_use_background_image === 'true' || theme.tabbar_use_background_image === true) {
                    document.getElementById('tabbar_bg_image_option').checked = true;
                    document.getElementById('tabbar_bg_color_group').style.display = 'none';
                    document.getElementById('tabbar_bg_image_group').style.display = 'block';
                    document.getElementById('tabbar_use_background_image').value = 'true';
                    
                    // æ˜¾ç¤ºå½“å‰TabBarèƒŒæ™¯å›¾ç‰‡
                    if (theme.tabbar_background_image) {
                        const currentTabbarBgImage = document.getElementById('current-tabbar-bg-image');
                        if (currentTabbarBgImage) {
                            currentTabbarBgImage.src = theme.tabbar_background_image;
                            currentTabbarBgImage.parentElement.style.display = 'block';
                        }
                    }
                } else {
                    document.getElementById('tabbar_bg_color_option').checked = true;
                    document.getElementById('tabbar_bg_color_group').style.display = 'block';
                    document.getElementById('tabbar_bg_image_group').style.display = 'none';
                    document.getElementById('tabbar_use_background_image').value = 'false';
                }
                
                document.getElementById('tabbar_background_color').value = theme.tabbar_background_color || '#FFFFFF';
                document.getElementById('tabbar_opacity').value = theme.tabbar_opacity || '1';
                document.getElementById('tabbar_font_size').value = theme.tabbar_font_size || '12';
            }
            
            console.log('å·²å®Œæˆä¸»é¢˜è¡¨å•æ•°æ®å¡«å……');
        }
        
        // è¡¨å•æäº¤å¤„ç†
        document.getElementById('theme-edit-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            await updateTheme();
        });
        
        // æ›´æ–°ä¸»é¢˜
        async function updateTheme() {
            const themeId = document.getElementById('theme-id').value;
            
            if (!themeId) {
                showErrorMessage('æœªæ‰¾åˆ°ä¸»é¢˜ID');
                return;
            }
            
            // é˜²æ­¢é‡å¤æäº¤
            const submitButton = document.getElementById('edit-submit-button');
            if (submitButton.disabled) {
                console.log('æäº¤æŒ‰é’®å·²ç¦ç”¨ï¼Œæ­£åœ¨å¤„ç†ä¸Šä¸€æ¬¡æäº¤...');
                return;
            }
            
            // ç¦ç”¨æäº¤æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤æäº¤
            submitButton.disabled = true;
            submitButton.textContent = 'æäº¤ä¸­...';
            
            try {
                // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
                document.getElementById('loading-indicator').style.display = 'block';
                
                // æ”¶é›†è¡¨å•æ•°æ®
                const rawFormData = new FormData(document.getElementById('theme-edit-form'));
                
                // è§„èŒƒåŒ–å­—æ®µå
                console.log('æ­£åœ¨è§„èŒƒåŒ–è¡¨å•å­—æ®µ...');
                const formData = FieldNormalizer.normalizeFormData(rawFormData);
                
                // è°ƒè¯•: è¾“å‡ºè§„èŒƒåŒ–åçš„å­—æ®µ
                console.log('è§„èŒƒåŒ–åçš„è¡¨å•å­—æ®µ:');
                for (const [key, value] of formData.entries()) {
                    const valueDisplay = value instanceof File ? 
                        `File: ${value.name}, ç±»å‹: ${value.type}, å¤§å°: ${value.size}` : value;
                    console.log(`- ${key}: ${valueDisplay}`);
                }
                
                // ä½¿ç”¨æ­£ç¡®çš„APIç«¯ç‚¹
                const token = localStorage.getItem('auth_token');
                if (!token) {
                    throw new Error('æœªç™»å½•æˆ–è®¤è¯ä»¤ç‰Œç¼ºå¤±ï¼Œè¯·é‡æ–°ç™»å½•');
                }
                
                console.log(`æ­£åœ¨æäº¤æ›´æ–°ä¸»é¢˜è¯·æ±‚ (ID: ${themeId})...`);
                const response = await fetch(`/api/skin/${themeId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`æœåŠ¡å™¨å“åº”é”™è¯¯: ${response.status} ${errorData.message || response.statusText}`);
                }
                
                const result = await response.json();
                console.log('æ›´æ–°ä¸»é¢˜æˆåŠŸ:', result);
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showSuccessMessage('ä¸»é¢˜æ›´æ–°æˆåŠŸï¼');
                
                // è·³è½¬åˆ°æŸ¥çœ‹é¡µé¢
                setTimeout(() => {
                    window.location.href = `detail.html?id=${themeId}`;
                }, 1500);
            } catch (error) {
                console.error('æ›´æ–°ä¸»é¢˜å¤±è´¥:', error);
                showErrorMessage(`æ›´æ–°ä¸»é¢˜å¤±è´¥: ${error.message}`);
                
                // é‡æ–°å¯ç”¨æäº¤æŒ‰é’®
                submitButton.disabled = false;
                submitButton.textContent = 'ç¡®è®¤æäº¤';
            } finally {
                // éšè—åŠ è½½æŒ‡ç¤ºå™¨
                document.getElementById('loading-indicator').style.display = 'none';
            }
        }
        
        // å–æ¶ˆæŒ‰é’®äº‹ä»¶
        document.getElementById('cancel-edit-button').addEventListener('click', function() {
            if (confirm('ç¡®å®šå–æ¶ˆç¼–è¾‘ï¼Ÿæœªä¿å­˜çš„æ›´æ”¹å°†ä¸¢å¤±ã€‚')) {
                const themeId = getUrlParam('id');
                window.location.href = themeId ? `detail.html?id=${themeId}` : 'index.html';
            }
        });
        
        // å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
        document.getElementById('detail_image').addEventListener('change', function(e) {
            const preview = document.getElementById('detail-image-preview');
            previewImage(this, preview);
        });
        
        document.getElementById('preview_image').addEventListener('change', function(e) {
            const preview = document.getElementById('preview-image-preview');
            previewImage(this, preview);
        });
        
        document.getElementById('global_background_image').addEventListener('change', function(e) {
            const preview = document.getElementById('global-background-preview');
            previewImage(this, preview);
        });
        
        function previewImage(input, previewElement) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    previewElement.src = e.target.result;
                    previewElement.style.display = 'block';
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // èƒŒæ™¯ç±»å‹åˆ‡æ¢
        document.getElementById('global_bg_color_option').addEventListener('change', function() {
            document.getElementById('global_bg_color_group').style.display = 'block';
            document.getElementById('global_bg_image_group').style.display = 'none';
            document.getElementById('has_global_background_image').value = 'false';
        });
        
        document.getElementById('global_bg_image_option').addEventListener('change', function() {
            document.getElementById('global_bg_color_group').style.display = 'none';
            document.getElementById('global_bg_image_group').style.display = 'block';
            document.getElementById('has_global_background_image').value = 'true';
        });
        
        // ä¾§è¾¹æ åˆ‡æ¢
        document.getElementById('toggle-sidebar').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content-wrapper');
            
            sidebar.classList.toggle('active');
            mainContent.classList.toggle('sidebar-active');
        });
        
        // é¡µé¢åŠ è½½å®ŒæˆååŠ è½½ä¸»é¢˜æ•°æ®
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šé¢œè‰²å¸ç›˜å’Œè¾“å…¥æ¡†åŒæ­¥äº‹ä»¶
            setupColorInputSync();
            
            loadThemeData();
        });

        // è®¾ç½®é¢œè‰²å¸ç›˜å’Œè¾“å…¥æ¡†åŒæ­¥
        function setupColorInputSync() {
            // è·å–æ‰€æœ‰é¢œè‰²è¾“å…¥æ¡†
            const colorInputs = document.querySelectorAll('input[type="color"]');
            
            colorInputs.forEach(colorInput => {
                const inputId = colorInput.id;
                const textInput = document.getElementById(`${inputId}_text`);
                
                if (textInput) {
                    // åˆå§‹åŒæ­¥é¢œè‰²å€¼åˆ°æ–‡æœ¬æ¡†
                    textInput.value = colorInput.value;
                    
                    // å½“é¢œè‰²é€‰æ‹©å™¨å˜åŒ–æ—¶ï¼Œæ›´æ–°æ–‡æœ¬æ¡†
                    colorInput.addEventListener('input', function() {
                        textInput.value = this.value;
                    });
                    
                    // å½“æ–‡æœ¬æ¡†å˜åŒ–æ—¶ï¼Œæ›´æ–°é¢œè‰²é€‰æ‹©å™¨
                    textInput.addEventListener('input', function() {
                        // ç¡®ä¿æ–‡æœ¬æ¡†å€¼æ˜¯æœ‰æ•ˆçš„é¢œè‰²æ ¼å¼
                        if (/^#[0-9A-F]{6}$/i.test(this.value)) {
                            colorInput.value = this.value;
                        }
                    });
                }
            });
        }

        // ç»“æœåŒºåŸŸèƒŒæ™¯ç±»å‹åˆ‡æ¢
        document.getElementById('result_bg_color_option').addEventListener('change', function() {
            document.getElementById('result_bg_color_group').style.display = 'block';
            document.getElementById('result_bg_image_group').style.display = 'none';
            document.getElementById('result_use_image').value = 'false';
        });

        document.getElementById('result_bg_image_option').addEventListener('change', function() {
            document.getElementById('result_bg_color_group').style.display = 'none';
            document.getElementById('result_bg_image_group').style.display = 'block';
            document.getElementById('result_use_image').value = 'true';
        });

        // TabBarèƒŒæ™¯ç±»å‹åˆ‡æ¢
        document.getElementById('tabbar_bg_color_option').addEventListener('change', function() {
            document.getElementById('tabbar_bg_color_group').style.display = 'block';
            document.getElementById('tabbar_bg_image_group').style.display = 'none';
            document.getElementById('tabbar_use_background_image').value = 'false';
        });

        document.getElementById('tabbar_bg_image_option').addEventListener('change', function() {
            document.getElementById('tabbar_bg_color_group').style.display = 'none';
            document.getElementById('tabbar_bg_image_group').style.display = 'block';
            document.getElementById('tabbar_use_background_image').value = 'true';
        });

        // æŒ‰é’®ç±»å‹åˆ‡æ¢
        document.querySelectorAll('.button-type-link').forEach(button => {
            button.addEventListener('click', function() {
                const targetType = this.getAttribute('data-button-type');
                if (!targetType) return;
                
                // éšè—æ‰€æœ‰æŒ‰é’®ç±»å‹è®¾ç½®
                document.querySelectorAll('.button-type-settings').forEach(panel => {
                    panel.style.display = 'none';
                });
                
                // æ˜¾ç¤ºç›®æ ‡æŒ‰é’®ç±»å‹è®¾ç½®
                const targetPanel = document.getElementById(`${targetType}-settings`);
                if (targetPanel) {
                    targetPanel.style.display = 'block';
                }
                
                // æ›´æ–°æŒ‰é’®ç±»å‹å¯¼èˆªçŠ¶æ€
                document.querySelectorAll('.button-type-link').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
            });
        });

        // æŒ‰é’®å›¾ç‰‡/é¢œè‰²åˆ‡æ¢å‡½æ•°
        function updateButtonTypeVisibility(type, useImage) {
            // æŸ¥æ‰¾æ‰€æœ‰å›¾ç‰‡ç›¸å…³æ§ä»¶
            const imageFields = document.querySelectorAll(`[id^="button_TYPE_${type}_"][id$="_image"]`);
            imageFields.forEach(el => {
                if (el.id !== `button_TYPE_${type}_use_image`) { // æ’é™¤checkboxè‡ªèº«
                    const parent = el.closest('.form-group');
                    if (parent) parent.style.display = useImage ? 'block' : 'none';
                }
            });

            // æŸ¥æ‰¾æ‰€æœ‰é¢œè‰²ç›¸å…³æ§ä»¶
            const colorFields = document.querySelectorAll(`[id^="button_TYPE_${type}_"][id$="_color"]`);
            colorFields.forEach(el => {
                const parent = el.closest('.form-group');
                if (parent && !parent.classList.contains('checkbox-group')) {
                    parent.style.display = useImage ? 'none' : 'block';
                }
            });
        }

        // è®¾ç½®Aç±»æŒ‰é’®å›¾ç‰‡/é¢œè‰²åˆ‡æ¢
        document.getElementById('button_TYPE_A_use_image').addEventListener('change', function() {
            updateButtonTypeVisibility('A', this.checked);
        });

        // ç»“æœåŒºèƒŒæ™¯å›¾ç‰‡é¢„è§ˆ
        document.getElementById('result_background_image').addEventListener('change', function(e) {
            const preview = document.getElementById('result-background-preview');
            previewImage(this, preview);
        });

        // TabBarèƒŒæ™¯å›¾ç‰‡é¢„è§ˆ
        document.getElementById('tabbar_background_image').addEventListener('change', function(e) {
            const preview = document.getElementById('tabbar-background-preview');
            previewImage(this, preview);
        });

        // æŒ‰é’®å›¾ç‰‡é¢„è§ˆ
        document.getElementById('button_TYPE_A_pressed_image').addEventListener('change', function(e) {
            const preview = document.getElementById('button-a-pressed-preview');
            previewImage(this, preview);
        });

        document.getElementById('button_TYPE_A_released_image').addEventListener('change', function(e) {
            const preview = document.getElementById('button-a-released-preview');
            previewImage(this, preview);
        });

        // èƒŒæ™¯é€æ˜åº¦æ‹–åŠ¨æ¡æ•°å€¼è”åŠ¨
        document.getElementById('tabbar_opacity').addEventListener('input', function() {
            document.getElementById('tabbar_opacity_value').textContent = this.value;
        });

        // ç¡®ä¿æäº¤æŒ‰é’®ç»‘å®šäº†äº‹ä»¶
        const editSubmitButton = document.getElementById('edit-submit-button');
        if (editSubmitButton) {
            editSubmitButton.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('ç¡®è®¤æäº¤æŒ‰é’®è¢«ç‚¹å‡»');
                updateTheme();
            });
        }
    </script>
</body>
</html> 